# نظام التقارير الشامل - وثائق النظام

## مقدمة

نظام التقارير في نظام أحداثي هو نظام متكامل يهدف إلى معالجة جميع مشكلات التقارير الحالية وتقديم حلول متطورة لإنشاء وتصدير وطباعة التقارير بطريقة احترافية وسلسة.

## المكونات الرئيسية للنظام

### 1. سياق التقارير (ReportContext)

- يوفر إعدادات موحدة لجميع التقارير في النظام
- يتيح تخصيص إعدادات التقرير بشكل مركزي
- يدعم التعدد اللغوي والاتجاه RTL/LTR

### 2. واجهة تهيئة التقارير (ReportConfig)

- تعرف هيكلة التهيئة الموحدة لكل التقارير
- تتضمن إعدادات الشركة، معلومات التقرير، تصميم التقرير، خيارات الطباعة، خيارات التصدير، والأذونات

### 3. قالب التقرير الموحد (BaseReportTemplate)

- قاعدة لجميع التقارير في النظام
- يضمن توافق التصميم والوظائف عبر جميع التقارير
- يدعم إعدادات متعددة مثل الطباعة، التصدير، QR Code

### 4. أدوات التصدير (ExportUtils)

- دعم تصدير التقارير إلى PDF، Excel، CSV
- وظائف لتحويل البيانات إلى تنسيقات قابلة للتصدير
- وظائف لتصدير أجزاء محددة من الصفحة

### 5. خطاف التخزين المؤقت (useReportCache)

- تحسين أداء التقارير من خلال تخزين البيانات مؤقتًا
- دعم لتحديد فترة صلاحية البيانات
- وظائف لتنظيف وتحديث البيانات المخزنة

### 6. مكون التصفح (Pagination)

- دعم تصفح التقارير الكبيرة
- واجهة سهلة الاستخدام للتنقل بين الصفحات
- دعم للانتقال إلى صفحة محددة

### 7. منشئ التقارير (ReportBuilder)

- واجهة سهلة لإنشاء تقارير مخصصة
- دعم لإضافة وتصفية الحقول
- وظيفة معاينة التقرير قبل الإنشاء

### 8. مكونات التعامل مع الأخطاء (ReportErrorBoundary)

- التعامل مع أخطاء التقارير بطريقة احترافية
- تقديم واجهة بديلة عند حدوث أخطاء
- تسجيل الأخطاء لتحليلها لاحقًا

## كيفية الاستخدام

### 1. إنشاء تقرير جديد

```tsx
import { BaseReportTemplate } from '../components/reports/BaseReportTemplate';
import { ReportProvider } from '../contexts/ReportContext';

const MyReport = () => {
  return (
    <ReportProvider initialConfig={{
      companyInfo: {
        name: 'اسم الشركة',
        phone: 'رقم الهاتف',
        // ... باقي الإعدادات
      }
    }}>
      <BaseReportTemplate title="عنوان التقرير" includeQRCode={true}>
        {/* محتوى التقرير */}
        <div>محتوى التقرير هنا</div>
      </BaseReportTemplate>
    </ReportProvider>
  );
};
```

### 2. استخدام التخزين المؤقت

```tsx
import { useReportCache } from '../hooks/useReportCache';

const MyReportWithCache = () => {
  const { data, loading, error, refreshData } = useReportCache(
    'my-report-key',
    async () => {
      // جلب البيانات من الخادم
      const response = await fetch('/api/report-data');
      return response.json();
    },
    300000 // 5 دقائق
  );

  if (loading) return <div>جاري التحميل...</div>;
  if (error) return <div>حدث خطأ: {error.message}</div>;

  return (
    <BaseReportTemplate title="تقرير مع تخزين مؤقت">
      {/* عرض البيانات */}
    </BaseReportTemplate>
  );
};
```

### 3. إضافة التصفح للتقرير الكبير

```tsx
import { Pagination } from '../components/reports/Pagination';

const PaginatedReport = () => {
  const [currentPage, setCurrentPage] = useState(1);
  const totalPages = 10; // مثال

  return (
    <BaseReportTemplate title="تقرير م_paginated">
      {/* محتوى الصفحة الحالية */}
      
      <Pagination
        currentPage={currentPage}
        totalPages={totalPages}
        onPageChange={setCurrentPage}
      />
    </BaseReportTemplate>
  );
};
```

## الميزات المتطورة

### 1. دعم اللغة العربية والاتجاه RTL

- جميع المكونات تدعم الاتجاه من اليمين إلى اليسار
- تنسيقات خاصة باللغة العربية
- دعم لعرض الأرقام بطريقة مناسبة

### 2. التوافق مع المعايير الرسمية

- التصاميم تتوافق مع معايير ZATCA للinvoices
- دعم لرموز QR للتحقق من التقارير
- تنسيقات مناسبة للوثائق الرسمية

### 3. الوظائف المتقدمة

- دعم للطباعة الاحترافية
- وظائف تصدير متعددة التنسيقات
- واجهة إنشاء تقارير مخصصة
- نظام تخزين مؤقت لتحسين الأداء

## أفضل الممارسات

### 1. هيكلة البيانات

- استخدام واجهات TypeScript لتحديد هيكلة البيانات
- التأكد من توافق البيانات مع قالب التقرير
- استخدام وظائف التحقق من صحة البيانات

### 2. الأداء

- استخدام التخزين المؤقت للبيانات المتكررة
- تحميل البيانات بشكل فوري عند الحاجة
- استخدام التصفح للبيانات الكبيرة

### 3. التصميم

- استخدام قالب التقرير الموحد دائمًا
- الحفاظ على توافق التصميم مع باقي النظام
- دعم جميع أحجام الشاشات

### 4. التعامل مع الأخطاء

- استخدام مكونات التعامل مع الأخطاء
- تقديم رسائل واضحة للمستخدم
- تسجيل الأخطاء لتحليلها لاحقًا

## اختبارات النظام

### 1. اختبارات الوظائف

- التأكد من عمل جميع وظائف التصدير
- التحقق من دعم الطباعة في جميع المتصفحات
- اختبار التخزين المؤقت وتحديث البيانات

### 2. اختبارات التصميم

- التأكد من دعم الاتجاه RTL
- التحقق من الاستجابة على جميع أحجام الشاشات
- اختبار الطباعة على مختلف الطابعات

### 3. اختبارات الأداء

- قياس زمن تحميل التقارير
- اختبار الأداء مع كميات كبيرة من البيانات
- التحقق من استخدام الذاكرة

## ختام

نظام التقارير الشامل يمثل خطوة كبيرة في تحسين جودة ووظائف التقارير في النظام. من خلال المكونات المتكاملة والممارسات الموصى بها، يمكن للمطورين إنشاء تقارير احترافية بسهولة وسرعة.

لأي استفسارات حول النظام، يرجى الرجوع إلى فريق التطوير.