# ููุญู ุฃ: ุฎุทุฉ ุฅุฏุงุฑุฉ Downtime
**ุงููุฏู:** ุชูููู ุชุฃุซูุฑ ูุชุฑุงุช ุงูุตูุงูุฉ ุนูู ุงููุณุชุฎุฏููู ูุถูุงู ุงูุชูุงู ุณูุณ

---

## 1. ููุงูุฐ ุงูุตูุงูุฉ ุงููุทููุจุฉ

### 1.1 ุฌุฏูู ููุงูุฐ ุงูุตูุงูุฉ

| ุงููุฑุญูุฉ | ุงููุฏุฉ ุงููุชููุนุฉ | ุงูุชูููุช ุงูููุตู ุจู | ุงูุณุจุจ | ุงูุชุฃุซูุฑ |
|---------|----------------|-------------------|--------|---------|
| **ุงููุฑุญูุฉ 0.5** | 2-3 ุณุงุนุงุช | ูููุงู (2-5 ุตุจุงุญุงู) | ุชูุธูู ุงูุจูุงูุงุช | ูุฑุงุกุฉ ููุท |
| **ุงููุฑุญูุฉ 1** | 3-5 ุณุงุนุงุช | ูููุงู (1-6 ุตุจุงุญุงู) | ุฅุถุงูุฉ Foreign Keys | ุฅููุงู ูุงูู |
| **ุงููุฑุญูุฉ 2** | 1-2 ุณุงุนุฉ | ูููุงู (3-5 ุตุจุงุญุงู) | ุฅูุดุงุก ุงูููุงุฑุณ | ูุฑุงุกุฉ ููุท |
| **ุงููุฑุญูุฉ 3** | 30-60 ุฏูููุฉ | ูููุงู (3-4 ุตุจุงุญุงู) | ุชุญุฏูุซ RLS | ูุฑุงุกุฉ ููุท |
| **ุงููุฑุญูุฉ 4** | 4-6 ุณุงุนุงุช | ููุงูุฉ ุฃุณุจูุน (ุงูุณุจุช 2-8 ุตุจุงุญุงู) | ุชุฎุทูุท ุงูุญุงููุงุช | ุฅููุงู ูุงูู |
| **ุงููุฑุญูุฉ 5** | 2-3 ุณุงุนุงุช | ูููุงู (2-5 ุตุจุงุญุงู) | ุงูุชูุณูู | ูุฑุงุกุฉ ููุท |

### 1.2 ูุนุงููุฑ ุงุฎุชูุงุฑ ุงูุชูููุช

```sql
-- ุชุญููู ุฃููุงุช ุงูุฐุฑูุฉ (ููุฐ ูุจู ุงูุชุฎุทูุท)
SELECT 
  EXTRACT(HOUR FROM created_at) as hour,
  COUNT(*) as booking_count,
  ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER (), 2) as percentage
FROM bookings
WHERE created_at >= NOW() - INTERVAL '30 days'
GROUP BY EXTRACT(HOUR FROM created_at)
ORDER BY hour;

-- ุงููุชูุฌุฉ ุงููุชููุนุฉ: ุฃูู ูุดุงุท ุจูู 2-6 ุตุจุงุญุงู
```

**ูุงุนุฏุฉ ุงูุงุฎุชูุงุฑ:**
- โ ุงุฎุชุฑ ุงูุณุงุนุงุช ุฐุงุช ุฃูู ูู 5% ูู ุงููุดุงุท ุงููููู
- โ ุชุฌูุจ ุนุทูุงุช ููุงูุฉ ุงูุฃุณุจูุน ููุตูุงูุฉ ุงููุตูุฑุฉ
- โ ุงุณุชุฎุฏู ููุงูุฉ ุงูุฃุณุจูุน ููุตูุงูุฉ ุงูุทูููุฉ (> 4 ุณุงุนุงุช)

---

## 2. ุฎุทุฉ ุงูุฅุดุนุงุฑุงุช

### 2.1 ุฌุฏูู ุงูุฅุดุนุงุฑุงุช

| ุงูุชูููุช | ุงูููุงุฉ | ุงูุฌูููุฑ | ุงูุฑุณุงูุฉ |
|---------|--------|---------|---------|
| **7 ุฃูุงู ูุจู** | ุจุฑูุฏ ุฅููุชุฑููู | ุฌููุน ุงูุดุฑูุงุก | ุฅุดุนุงุฑ ูุจุฏุฆู ุจุงูุตูุงูุฉ ุงููุฌุฏููุฉ |
| **3 ุฃูุงู ูุจู** | ุจุฑูุฏ + ุฅุดุนุงุฑ ุฏุงุฎู ุงููุธุงู | ุฌููุน ุงููุณุชุฎุฏููู | ุชุฐููุฑ ุจุงูุตูุงูุฉ ุงููุงุฏูุฉ |
| **24 ุณุงุนุฉ ูุจู** | ุจุฑูุฏ + SMS + ุฅุดุนุงุฑ | ุฌููุน ุงููุณุชุฎุฏููู | ุชุฃููุฏ ููุงุฆู ููุตูุงูุฉ |
| **1 ุณุงุนุฉ ูุจู** | ุฅุดุนุงุฑ ุฏุงุฎู ุงููุธุงู | ุงููุณุชุฎุฏููู ุงููุดุทูู | ุชุญุฐูุฑ ูุจู ุงูุฅููุงู |
| **ุฃุซูุงุก ุงูุตูุงูุฉ** | ุตูุญุฉ ุตูุงูุฉ | ุฌููุน ุงูุฒูุงุฑ | ุญุงูุฉ ุงูุตูุงูุฉ ุงูุญุงููุฉ |
| **ุจุนุฏ ุงูุงูุชูุงุก** | ุจุฑูุฏ + ุฅุดุนุงุฑ | ุฌููุน ุงููุณุชุฎุฏููู | ุฅุดุนุงุฑ ุจุนูุฏุฉ ุงูุฎุฏูุฉ |

### 2.2 ููุงูุจ ุงูุฑุณุงุฆู

#### ุฅุดุนุงุฑ 7 ุฃูุงู ูุจู (ููุดุฑูุงุก)
```
ุงูููุถูุน: ุตูุงูุฉ ูุฌุฏููุฉ ูุชุญุณูู ุงููุธุงู - [ุงูุชุงุฑูุฎ]

ุนุฒูุฒู ุงูุดุฑููุ

ููุฏ ุฅุนูุงูู ุจุตูุงูุฉ ูุฌุฏููุฉ ูุชุญุณูู ุฃุฏุงุก ูุฃูุงู ุงููุธุงู:

๐ ุงูุชุงุฑูุฎ: [ุงูุชุงุฑูุฎ]
๐ ุงูููุช: [ุงูููุช ุงูุจุฏุงูุฉ] - [ุงูููุช ุงูููุงูุฉ]
โฑ๏ธ ุงููุฏุฉ ุงููุชููุนุฉ: [ุงููุฏุฉ]
๐ง ุงูุชุฃุซูุฑ: [ุฅููุงู ูุงูู / ูุฑุงุกุฉ ููุท]

ุงูุชุญุณููุงุช ุงููุชููุนุฉ:
โ ุชุญุณูู ุณุฑุนุฉ ุงููุธุงู
โ ุชุนุฒูุฒ ุงูุฃูุงู
โ ุฅุถุงูุฉ ููุฒุงุช ุฌุฏูุฏุฉ

ูุนุชุฐุฑ ุนู ุฃู ุฅุฒุนุงุฌ.
ูุฑูู ุงูุฏุนู ุงูููู
```

#### ุฅุดุนุงุฑ 24 ุณุงุนุฉ ูุจู (ูููุณุชุฎุฏููู)
```
ุงูููุถูุน: ุชุฐููุฑ: ุตูุงูุฉ ุงููุธุงู ุบุฏุงู

ุนุฒูุฒู ุงููุณุชุฎุฏูุ

ุชุฐููุฑ ุจุงูุตูุงูุฉ ุงููุฌุฏููุฉ ุบุฏุงู:

โฐ ูู: [ุงูููุช ุงูุจุฏุงูุฉ]
โฐ ุฅูู: [ุงูููุช ุงูููุงูุฉ]

ุฎูุงู ูุฐู ุงููุชุฑุฉ:
โ ูู ุชุชููู ูู ุฅุฌุฑุงุก ุญุฌูุฒุงุช ุฌุฏูุฏุฉ
โ ููููู ูุฑุงุฌุนุฉ ุญุฌูุฒุงุชู ุงูุญุงููุฉ (ุฅู ูุงู ูุถุน ูุฑุงุกุฉ ููุท)

ููุตู ุจุฅููุงู ุฃู ูุนุงููุงุช ูุจู ุจุฏุก ุงูุตูุงูุฉ.

ุดูุฑุงู ูุชูููู
```

### 2.3 ุณูุฑูุจุช ุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช

```sql
-- ุฅูุดุงุก ุฅุดุนุงุฑุงุช ุงูุตูุงูุฉ
INSERT INTO notifications (
  user_id,
  title,
  message,
  notification_type,
  created_at
)
SELECT 
  user_id,
  'ุตูุงูุฉ ูุฌุฏููุฉ ูููุธุงู',
  'ุณูููู ุงููุธุงู ุชุญุช ุงูุตูุงูุฉ ูู [ุงูููุช ุงูุจุฏุงูุฉ] ุฅูู [ุงูููุช ุงูููุงูุฉ]. ูุนุชุฐุฑ ุนู ุฃู ุฅุฒุนุงุฌ.',
  'system',
  NOW()
FROM users
WHERE is_active = TRUE;

-- ุฅุฑุณุงู ุจุฑูุฏ ุฅููุชุฑููู (ุนุจุฑ Edge Function)
SELECT notify_users_via_email(
  'ุตูุงูุฉ ูุฌุฏููุฉ',
  'ุณูููู ุงููุธุงู ุชุญุช ุงูุตูุงูุฉ...',
  ARRAY(SELECT user_id FROM users WHERE is_active = TRUE)
);
```

---

## 3. ุตูุญุฉ ุงูุตูุงูุฉ

### 3.1 ุชูุนูู ูุถุน ุงูุตูุงูุฉ

```sql
-- ุชูุนูู ูุถุน ุงูุตูุงูุฉ
UPDATE ui_site_settings
SET setting_value = 'true'
WHERE setting_key = 'maintenance_mode';

-- ุฅุถุงูุฉ ุฑุณุงูุฉ ูุฎุตุตุฉ
UPDATE ui_site_settings
SET setting_value = 'ุงููุธุงู ุชุญุช ุงูุตูุงูุฉ ุญุงููุงู. ุณูุนูุฏ ุฎูุงู [ุงููุฏุฉ ุงููุชููุนุฉ].'
WHERE setting_key = 'maintenance_message';

-- ุฅุถุงูุฉ ููุช ุงูุงูุชูุงุก ุงููุชููุน
UPDATE ui_site_settings
SET setting_value = '[ุงูููุช ุงููุชููุน]'
WHERE setting_key = 'maintenance_end_time';
```

### 3.2 ุชุตููู ุตูุญุฉ ุงูุตูุงูุฉ

```typescript
// src/pages/MaintenancePage.tsx (ุชุญุฏูุซ)
export default function MaintenancePage() {
  const { data: settings } = useUISiteSettings();
  const maintenanceMessage = settings?.maintenance_message;
  const endTime = settings?.maintenance_end_time;
  
  return (
    <div className="maintenance-page">
      <div className="maintenance-icon">๐ง</div>
      <h1>ุงููุธุงู ุชุญุช ุงูุตูุงูุฉ</h1>
      <p>{maintenanceMessage}</p>
      
      {endTime && (
        <div className="countdown">
          <p>ุงูููุช ุงููุชููุน ููุงูุชูุงุก:</p>
          <h2>{endTime}</h2>
        </div>
      )}
      
      <div className="maintenance-info">
        <h3>ูุง ุงูุฐู ูุนูู ุนูููุ</h3>
        <ul>
          <li>โ ุชุญุณูู ุณุฑุนุฉ ุงููุธุงู</li>
          <li>โ ุชุนุฒูุฒ ุงูุฃูุงู</li>
          <li>โ ุฅุตูุงุญ ุงูุฃุฎุทุงุก</li>
        </ul>
      </div>
      
      <p className="apology">ูุนุชุฐุฑ ุนู ุฃู ุฅุฒุนุงุฌ ููุดูุฑ ุตุจุฑูู</p>
    </div>
  );
}
```

---

## 4. ุฎุทุฉ ุงูุทูุงุฑุฆ

### 4.1 ุณููุงุฑูููุงุช ุงูุทูุงุฑุฆ

| ุงูุณููุงุฑูู | ุงูุฅุฌุฑุงุก | ุงููุณุคูู | ุงูููุช ุงููุชููุน |
|-----------|---------|---------|---------------|
| **ุชุฌุงูุฒ ุงููุฏุฉ ุงููุฎุทุทุฉ** | ุชูุฏูุฏ ูุงูุฐุฉ ุงูุตูุงูุฉ + ุฅุดุนุงุฑ ุงููุณุชุฎุฏููู | ูุฏูุฑ ุงููุธุงู | ููุฑู |
| **ูุดู Migration** | ุชูููุฐ Rollback ููุฑุงู | ูููุฏุณ ูุงุนุฏุฉ ุงูุจูุงูุงุช | 15-30 ุฏูููุฉ |
| **ูุณุงุฏ ุจูุงูุงุช** | ุงุณุชุนุงุฏุฉ ูู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ | ูุฏูุฑ ุงููุธุงู | 30-60 ุฏูููุฉ |
| **ูุดุงูู ุฃุฏุงุก ุจุนุฏ ุงูุตูุงูุฉ** | ุชุนุทูู ุงูููุฒุฉ ุงูุฌุฏูุฏุฉ + ุชุญููู | ูุฑูู ุงูุชุทููุฑ | 10-20 ุฏูููุฉ |
| **ุฃุฎุทุงุก ุชุทุจูู** | Rollback + ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุณุงุจูุฉ | ูุฑูู DevOps | 20-40 ุฏูููุฉ |

### 4.2 ูุงุฆูุฉ ุฌูุงุช ุงูุงุชุตุงู ุงูุทุงุฑุฆุฉ

```markdown
## ูุฑูู ุงูุทูุงุฑุฆ

### ุงููุณุชูู 1 (ุงูุงุณุชุฌุงุจุฉ ุงูููุฑูุฉ)
- ูุฏูุฑ ุงููุธุงู: [ุงูุงุณู] - [ุงููุงุชู]
- ูููุฏุณ ูุงุนุฏุฉ ุงูุจูุงูุงุช: [ุงูุงุณู] - [ุงููุงุชู]

### ุงููุณุชูู 2 (ุงูุฏุนู ุงูููู)
- ูุทูุฑ Backend: [ุงูุงุณู] - [ุงููุงุชู]
- ูุทูุฑ Frontend: [ุงูุงุณู] - [ุงููุงุชู]

### ุงููุณุชูู 3 (ุงูุฅุฏุงุฑุฉ)
- ูุฏูุฑ ุงููุดุฑูุน: [ุงูุงุณู] - [ุงููุงุชู]
- ุงููุฏูุฑ ุงูุชูููุฐู: [ุงูุงุณู] - [ุงููุงุชู]
```

### 4.3 ุณูุฑูุจุช Rollback ุงูุณุฑูุน

```bash
#!/bin/bash
# emergency_rollback.sh

echo "๐จ ุจุฏุก Rollback ุงูุทุงุฑุฆ..."

# 1. ุชูุนูู ูุถุน ุงูุตูุงูุฉ
psql -c "UPDATE ui_site_settings SET setting_value = 'true' WHERE setting_key = 'maintenance_mode';"

# 2. ุฅููุงู ุฌููุน ุงูุงุชุตุงูุงุช ุงููุดุทุฉ
psql -c "SELECT pg_terminate_backend(pid) FROM pg_stat_activity WHERE datname = 'postgres' AND pid <> pg_backend_pid();"

# 3. ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ
pg_restore -d postgres backup_pre_migration_$(date +%Y%m%d).sql

# 4. ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุฏูุงุช
systemctl restart postgresql
systemctl restart application

# 5. ุชุนุทูู ูุถุน ุงูุตูุงูุฉ
psql -c "UPDATE ui_site_settings SET setting_value = 'false' WHERE setting_key = 'maintenance_mode';"

echo "โ Rollback ููุชูู. ุชุญูู ูู ุญุงูุฉ ุงููุธุงู."
```

---

## 5. ุฎุทุฉ ุงูุงุชุตุงูุงุช

### 5.1 ูููุงุช ุงูุงุชุตุงู

| ุงูููุงุฉ | ุงูุงุณุชุฎุฏุงู | ุงูุฌูููุฑ |
|--------|-----------|---------|
| **ุงูุจุฑูุฏ ุงูุฅููุชุฑููู** | ุฅุดุนุงุฑุงุช ูุณุจูุฉ | ุฌููุน ุงููุณุชุฎุฏููู |
| **SMS** | ุชุฐููุฑุงุช ุนุงุฌูุฉ | ุงูุดุฑูุงุก ูุงููุณุชุฎุฏููู ุงููุดุทูู |
| **ุฅุดุนุงุฑุงุช ุฏุงุฎู ุงููุธุงู** | ุชุญุฏูุซุงุช ููุฑูุฉ | ุงููุณุชุฎุฏููู ุงููุณุฌููู |
| **ุตูุญุฉ ุงูุญุงูุฉ** | ุญุงูุฉ ุงูุตูุงูุฉ ุงูุญูุฉ | ุงูุฌููุน |
| **ูุณุงุฆู ุงูุชูุงุตู ุงูุงุฌุชูุงุนู** | ุฅุนูุงูุงุช ุนุงูุฉ | ุงููุชุงุจุนูู |

### 5.2 ุชุญุฏูุซุงุช ุงูุญุงูุฉ ุฃุซูุงุก ุงูุตูุงูุฉ

```markdown
## ุฌุฏูู ุงูุชุญุฏูุซุงุช

- **ุจุฏุงูุฉ ุงูุตูุงูุฉ:** "ุจุฏุฃุช ุงูุตูุงูุฉ ุงููุฌุฏููุฉ. ุงููุฏุฉ ุงููุชููุนุฉ: [ุงููุฏุฉ]"
- **ูู 30 ุฏูููุฉ:** "ุงูุตูุงูุฉ ูุณุชูุฑุฉ. ุงูุฅูุฌุงุฒ: [ุงููุณุจุฉ]%"
- **ุนูุฏ ุงูุชุฃุฎูุฑ:** "ุงูุตูุงูุฉ ุชุณุชุบุฑู ููุชุงู ุฃุทูู ูู ุงููุชููุน. ุงูููุช ุงูุฌุฏูุฏ: [ุงูููุช]"
- **ุนูุฏ ุงูุงูุชูุงุก:** "ุงูุชููุช ุงูุตูุงูุฉ ุจูุฌุงุญ. ุงููุธุงู ูุชุงุญ ุงูุขู."
```

---

## 6. ุงูุชุญูู ุจุนุฏ ุงูุตูุงูุฉ

### 6.1 ูุงุฆูุฉ ุงูุชุญูู ุงูุณุฑูุน

```markdown
## ุจุนุฏ ูู ุตูุงูุฉ:

- [ ] ุงููุธุงู ูุนูู ููุณุชุฌูุจ
- [ ] ูููู ูููุณุชุฎุฏููู ุชุณุฌูู ุงูุฏุฎูู
- [ ] ูููู ุฅูุดุงุก ุญุฌูุฒุงุช ุฌุฏูุฏุฉ
- [ ] ุงููุฏููุนุงุช ุชุนูู ุจุดูู ุตุญูุญ
- [ ] ุงูุฅุดุนุงุฑุงุช ุชุฑุณู ุจูุฌุงุญ
- [ ] ุงูุชูุงุฑูุฑ ุชุนูู
- [ ] ูุง ุชูุฌุฏ ุฃุฎุทุงุก ูู ุงูุณุฌูุงุช
- [ ] ุงูุฃุฏุงุก ุถูู ุงููุทุงู ุงูููุจูู
```

### 6.2 ุณูุฑูุจุช ุงูุชุญูู ุงูุขูู

```sql
-- post_maintenance_check.sql

DO $$
DECLARE
  error_count INTEGER;
  slow_query_count INTEGER;
BEGIN
  -- 1. ูุญุต ุงูุฃุฎุทุงุก ุงูุฃุฎูุฑุฉ
  SELECT COUNT(*) INTO error_count
  FROM pg_stat_database
  WHERE datname = 'postgres'
    AND conflicts > 0;
  
  IF error_count > 0 THEN
    RAISE WARNING 'Found % database conflicts', error_count;
  END IF;
  
  -- 2. ูุญุต ุงูุงุณุชุนูุงูุงุช ุงูุจุทูุฆุฉ
  SELECT COUNT(*) INTO slow_query_count
  FROM pg_stat_statements
  WHERE mean_exec_time > 1000; -- ุฃูุซุฑ ูู ุซุงููุฉ
  
  IF slow_query_count > 10 THEN
    RAISE WARNING 'Found % slow queries', slow_query_count;
  END IF;
  
  RAISE NOTICE 'โ Post-maintenance checks completed';
END $$;
```

---

## 7. ุงูุฏุฑูุณ ุงููุณุชูุงุฏุฉ

### 7.1 ูุงูุจ ุชูุฑูุฑ ูุง ุจุนุฏ ุงูุตูุงูุฉ

```markdown
# ุชูุฑูุฑ ูุง ุจุนุฏ ุงูุตูุงูุฉ - [ุงูุชุงุฑูุฎ]

## ุงูููุฎุต
- **ุงููุฑุญูุฉ:** [ุฑูู ุงููุฑุญูุฉ]
- **ุงููุฏุฉ ุงููุฎุทุทุฉ:** [ุงููุฏุฉ]
- **ุงููุฏุฉ ุงููุนููุฉ:** [ุงููุฏุฉ]
- **ุงูุญุงูุฉ:** [ูุฌุญ / ูุดู / ูุฌุญ ุฌุฒุฆูุงู]

## ูุง ุณุงุฑ ุจุดูู ุฌูุฏ
- [ููุทุฉ 1]
- [ููุทุฉ 2]

## ุงููุดุงูู ุงูุชู ูุงุฌููุงูุง
- [ูุดููุฉ 1] - ุงูุญู: [ุงูุญู]
- [ูุดููุฉ 2] - ุงูุญู: [ุงูุญู]

## ุงูุชุญุณููุงุช ูููุฑุฉ ุงููุงุฏูุฉ
- [ุชุญุณูู 1]
- [ุชุญุณูู 2]

## ุงูููุงููุณ
- **Downtime ุงููุนูู:** [ุงููุฏุฉ]
- **ุนุฏุฏ ุงููุณุชุฎุฏููู ุงููุชุฃุซุฑูู:** [ุงูุนุฏุฏ]
- **ุนุฏุฏ ุงูุฃุฎุทุงุก ุจุนุฏ ุงูุตูุงูุฉ:** [ุงูุนุฏุฏ]
- **ุชุญุณูู ุงูุฃุฏุงุก:** [ุงููุณุจุฉ]%
```

---

## โ ูุนุงููุฑ ุงููุฌุงุญ

- [ ] ุฌููุน ููุงูุฐ ุงูุตูุงูุฉ ูุฌุฏููุฉ ููุนุชูุฏุฉ
- [ ] ุฌููุน ุงูุฅุดุนุงุฑุงุช ูุฑุณูุฉ ูู ุงูููุช ุงููุญุฏุฏ
- [ ] ุตูุญุฉ ุงูุตูุงูุฉ ุฌุงูุฒุฉ ููุฎุชุจุฑุฉ
- [ ] ุฎุทุฉ ุงูุทูุงุฑุฆ ููุซูุฉ ููููููุฉ ูู ุงููุฑูู
- [ ] ูุฑูู ุงูุทูุงุฑุฆ ูุชุงุญ ููุณุชุนุฏ
- [ ] ุณูุฑูุจุชุงุช Rollback ูุฎุชุจุฑุฉ
- [ ] ูุงุฆูุฉ ุงูุชุญูู ุจุนุฏ ุงูุตูุงูุฉ ุฌุงูุฒุฉ
